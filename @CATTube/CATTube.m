classdef CATTube < CAT
    
    % GUI for CAT
    %
    %
    
    % Martin Iggland, first version 2013-12-04
    
    properties
        
        % GUI handles and stuff
        gui
        
    end % properties
    
    methods
        
        %% Constructor method
        
        function O = CATTube(varargin)
            
            % Call CAT constructor
            O = O@CAT( varargin{:} );
            
            % Start constructing GUI
            
            % Initialise the main GUI, define all buttons and graphics
            % objects
            
            %
            % Initialise the GUI
            %
            % Create the figure handle
            O.gui.fighandle = figure(...
                'MenuBar','none',...
                'Name','Looking at CATs',...
                'NumberTitle','off',...
                'Position',[200 200 1050 445],...
                'Resize','off');
            
            % Create GUI ui controls
            
            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            % Initial conditions
            %
            
            % Panel for initial conditions
            O.gui.init.panel = uipanel('Parent',O.gui.fighandle,...
                'Title','Initial settings',...
                'Units','pixels',...
                'Position',[20 300 500 125]);
            
            % Distribution
            % Text
            O.gui.init.init_dist_text = uicontrol(O.gui.init.panel,...
                'Style','text',...
                'String','Initial distribution function [Dist.]',...
                'Position',[10 85 240 20]);
            % Input box
            O.gui.init.init_dist = uicontrol(O.gui.init.panel,...
                'Style','edit',...
                'Enable','off',... It's not easy to define a distribution by typing, show only summary here
                'String',data2str(O.init_dist),...
                'TooltipString','Enter the initial distribution',...
                'Position',[250 85 140 20]);
            % Define button
            O.gui.init.init_dist_define = uicontrol(O.gui.init.panel,...
                'Style','pushbutton',...
                'String','Edit',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.editDist(hObject,eventdata),...
                'Position',[390 85 50 20]...
                );
            % Browse button
            O.gui.init.init_dist_browse = uicontrol(O.gui.init.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'init_dist',O.gui.init.init_dist,'Distribution'),...
                'Position',[440 85 50 20]...
                );
            
            % Seed mass
            % Text
            O.gui.init.init_seed_text = uicontrol(O.gui.init.panel,...
                'Style','text',...
                'String','Seed mass [?]',...
                'Position',[10 60 240 20]);
            % Input box
            O.gui.init.init_seed = uicontrol(O.gui.init.panel,...
                'Style','edit',...
                'String',data2str(O.init_seed),...
                'TooltipString','Enter the seed mass in UNITS',...
                'Callback',@(hObject,eventdata)set(O,'init_seed',str2double(get(hObject,'String'))),...
                'Position',[250 60 190 20]);
            % Browse button
            O.gui.init.init_seed_browse = uicontrol(O.gui.init.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'init_seed',O.gui.init.init_seed),...
                'Position',[440 60 50 20]...
                );
            
            % Mass medium (solvent + antisolvent?)
            % Text
            O.gui.init.init_massmedium_text = uicontrol(O.gui.init.panel,...
                'Style','text',...
                'String','Total solvent mass [?]',...
                'Position',[10 35 240 20]);
            % Input box
            O.gui.init.init_massmedium = uicontrol(O.gui.init.panel,...
                'Style','edit',...
                'String',data2str(O.init_massmedium),...
                'TooltipString','Enter the initial solvent mass in kg',...
                'Callback',@(hObject,eventdata)set(O,'init_massmedium',str2double(get(hObject,'String'))),...
                'Position',[250 35 190 20]);
            % Browse button
            O.gui.init.init_massmedium_browse = uicontrol(O.gui.init.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'init_massmedium',O.gui.init.init_massmedium),...
                'Position',[440 35 50 20]...
                );
            
            % c0
            % Text
            O.gui.init.init_conc_text = uicontrol(O.gui.init.panel,...
                'Style','text',...
                'String','Initial concentration [?]',...
                'Position',[10 10 240 20]);
            % Input box
            O.gui.init.init_conc = uicontrol(O.gui.init.panel,...
                'Style','edit',...
                'String','',...
                'TooltipString','Enter the initial concentration in kg',...
                'Callback',@(hObject,eventdata)set(O,'init_conc',str2double(get(hObject,'String'))),...
                'Position',[250 10 190 20]);
            % Browse button
            O.gui.init.init_conc_browse = uicontrol(O.gui.init.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'init_conc',O.gui.init.init_conc),...
                'Position',[440 10 50 20]...
                );
            
            
            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            % Process
            %
            
            % Panel for process settings
            O.gui.proc.panel = uipanel('Parent',O.gui.fighandle,...
                'Title','Process settings',...
                'Units','pixels',...
                'Position',[20 215 500 75]);
            
            % Tprofile
            % Text
            O.gui.proc.Tprofile_text = uicontrol(O.gui.proc.panel,...
                'Style','text',...
                'String','Temperature profile [?]',...
                'Position',[10 35 240 20]);
            % Input box
            O.gui.proc.Tprofile = uicontrol(O.gui.proc.panel,...
                'Style','edit',...
                'String',data2str(O.Tprofile),...
                'TooltipString','Enter the temperature profile: temperatures as a function of time (an. function; or table)',...
                'Callback',@(hObject,eventdata)set(O,'Tprofile',get(hObject,'String')),...
                'Position',[250 35 190 20]);
            % Browse button
            O.gui.proc.Tprofile_browse = uicontrol(O.gui.proc.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'Tprofile',O.gui.proc.Tprofile),...
                'Position',[440 35 50 20]...
                );
            
            % ASprofile
            % Text
            O.gui.proc.ASprofile_text = uicontrol(O.gui.proc.panel,...
                'Style','text',...
                'String','Antisolvent profile [?]',...
                'Position',[10 10 240 20]);
            % Input box
            O.gui.proc.ASprofile = uicontrol(O.gui.proc.panel,...
                'Style','edit',...
                'String',data2str(O.ASprofile),...
                'TooltipString','Enter the antisolvent profile: mass added as a function of time (an. function; or table)',...
                'Callback',@(hObject,eventdata)set(O,'ASprofile',get(hObject,'String')),...
                'Position',[250 10 190 20]);
            % Browse button
            O.gui.proc.ASprofile_browse = uicontrol(O.gui.proc.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'ASprofile',O.gui.proc.ASprofile),...
                'Position',[440 10 50 20]...
                );
            
            
            
            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            % Thermodynamics
            %
            
            % Panel for thermodynamics settings
            O.gui.td.panel = uipanel('Parent',O.gui.fighandle,...
                'Title','Thermodynamics and substance properties',...
                'Units','pixels',...
                'Position',[20 105 500 100]);
            
            % Solubility
            O.gui.td.solubility_text = uicontrol(O.gui.td.panel,...
                'Style','text',...
                'String','Solubility function: @(T,xm)',...
                'Position',[10 60 240 20]);
            
            % Input box
            O.gui.td.solubility = uicontrol(O.gui.td.panel,...
                'Style','edit',...
                'String','',...
                'TooltipString','Enter the solubility function as a function of temperature T and antisolvent mass fraction xm',...
                'Callback',@(hObject,eventdata)set(O,'solubility',get(hObject,'String')),...
                'Position',[250 60 190 20]);
            % Browse button
            O.gui.td.solubility_browse = uicontrol(O.gui.td.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'solubility',O.gui.td.solubility),...
                'Position',[440 60 50 20]...
                );
            
            % rhoc
            O.gui.td.rhoc_text = uicontrol(O.gui.td.panel,...
                'Style','text',...
                'String','Solid density [g/micron^3]',...
                'Position',[10 35 240 20]);
            
            % Input box
            O.gui.td.rhoc = uicontrol(O.gui.td.panel,...
                'Style','edit',...
                'String','',...
                'TooltipString','Enter the solid density',...
                'Callback',@(hObject,eventdata)set(O,'rhoc',str2double(get(hObject,'String'))),...
                'Position',[250 35 190 20]);
            % Browse button
            O.gui.td.rhoc_browse = uicontrol(O.gui.td.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'rhoc',O.gui.td.rhoc),...
                'Position',[440 35 50 20]...
                );
            
            % kv
            O.gui.td.kv_text = uicontrol(O.gui.td.panel,...
                'Style','text',...
                'String','Shape factor [0-1]',...
                'Position',[10 10 240 20]);
            % Input box
            O.gui.td.kv = uicontrol(O.gui.td.panel,...
                'Style','edit',...
                'String','1',...
                'TooltipString','Enter the shape factor',...
                'Callback',@(hObject,eventdata)set(O,'kv',str2double(get(hObject,'String'))),...
                'Position',[250 10 190 20]);
            % Browse button
            O.gui.td.kv_browse = uicontrol(O.gui.td.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'kv',O.gui.td.kv),...
                'Position',[440 10 50 20]...
                );
            
            
            
            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            % Kinetics
            %
            
            % Panel for kinetics settings
            O.gui.kin.panel = uipanel('Parent',O.gui.fighandle,...
                'Title','Kinetics',...
                'Units','pixels',...
                'Position',[20 20 500 75]);
            
            % Growth rate
            O.gui.kin.growthrate_text = uicontrol(O.gui.kin.panel,...
                'Style','text',...
                'String','Growth rate @(S,T,y)',...
                'Position',[10 35 240 20]);
            % Input box
            O.gui.kin.growthrate = uicontrol(O.gui.kin.panel,...
                'Style','edit',...
                'String','',...
                'TooltipString','Growth rate as a function of supersaturation (S), temperature (T) and size (y), in units of [m/s]',...
                'Callback',@(hObject,eventdata)set(O,'growthrate',get(hObject,'String')),...
                'Position',[250 35 190 20]);
            % Browse button
            O.gui.kin.growthrate_browse = uicontrol(O.gui.kin.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'growthrate',O.gui.kin.growthrate),...
                'Position',[440 35 50 20]...
                );
            
            % Nucleation rate
            O.gui.kin.nucleationrate_text = uicontrol(O.gui.kin.panel,...
                'Style','text',...
                'String','Nucleation rate',...
                'Position',[10 10 240 20]);
            % Input box
            O.gui.kin.nucleationrate = uicontrol(O.gui.kin.panel,...
                'Style','edit',...
                'String','',...
                'TooltipString','Nucleation rate as a function of ..., in units of [1/(s m^3)]',...
                'Callback',@(hObject,eventdata)set(O,'nucleationrate',get(hObject,'String')),...
                'Position',[250 10 190 20]);
            % Browse button
            O.gui.kin.nucleationrate_browse = uicontrol(O.gui.kin.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'nucleationrate',O.gui.kin.nucleationrate),...
                'Position',[440 10 50 20]...
                );
            
            
            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            % Solver
            %
            
            % Panel for solver settings
            O.gui.solv.panel = uipanel('Parent',O.gui.fighandle,...
                'Title','Solver settings',...
                'Units','pixels',...
                'Position',[530 325 500 100]);
            
            % Time
            O.gui.solv.sol_time_text = uicontrol(O.gui.solv.panel,...
                'Style','text',...
                'String','Time',...
                'Position',[10 60 240 20]);
            % Input box
            O.gui.solv.sol_time = uicontrol(O.gui.solv.panel,...
                'Style','edit',...
                'String','',...
                'TooltipString','Solver time, in seconds',...
                'Callback',@(hObject,eventdata)set(O,'sol_time',str2double(get(hObject,'String'))),...
                'Position',[250 60 190 20]);
            % Browse button
            O.gui.solv.sol_time_browse = uicontrol(O.gui.solv.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'sol_time',O.gui.solv.sol_time),...
                'Position',[440 60 50 20]...
                );
            
            % Solution method
            O.gui.solv.sol_method_text = uicontrol(O.gui.solv.panel,...
                'Style','text',...
                'String','Solution method',...
                'Position',[10 35 240 20]);
            % List box for choices
            O.gui.solv.sol_method = uicontrol(O.gui.solv.panel,...
                'Style','popup',...
                'String','Central difference|Moving pivot|Hires',...
                'TooltipString','Choose which method to use',...
                'Callback',@(hObject,eventdata) set(O,'sol_method',O.parenthesis(get(hObject,'String'),get(hObject,'Value'),':')),...
                'Position',[250 35 240 20]);
            
            % Options
            O.gui.solv.sol_options_text = uicontrol(O.gui.solv.panel,...
                'Style','text',...
                'String','Options',...
                'Position',[10 10 240 20]);
            % Input box
            O.gui.solv.sol_options = uicontrol(O.gui.solv.panel,...
                'Style','edit',...
                'String','',...
                'TooltipString','Solver options',...
                'Position',[250 10 190 20]);
            % Browse button
            O.gui.solv.sol_options_browse = uicontrol(O.gui.solv.panel,...
                'Style','pushbutton',...
                'String','Browse',...
                'Value',0,...
                'Callback',@(hObject,eventdata)O.browseVars(hObject,eventdata,'sol_options',O.gui.solv.sol_options),...
                'Position',[440 10 50 20]...
                );
            


            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            % Run panel
            %
            
            % Panel for running programs
            O.gui.run.panel = uipanel('Parent',O.gui.fighandle,...
                'Title','Run',...
                'Units','pixels',...
                'Position',[530 20 500 295]);
            
            % Solve button
            O.gui.run.start = uicontrol(O.gui.run.panel,...
                'Style','pushbutton',...
                'String','Solve',...
                'Value',0,...
                'Callback',@(hObject,Event)O.solve,...
                'Position',[20 180 450 30]...
                );
            
            % Write to file button
            O.gui.run.export = uicontrol(O.gui.run.panel,...
                'Style','pushbutton',...
                'String','Write settings to file',...
                'Value',0,...
                'Enable','off',...
                'Callback','',...
                'Position',[20 140 450 30]...
                );
            
            % Plot button
            O.gui.run.plot = uicontrol(O.gui.run.panel,...
                'Style','pushbutton',...
                'String','Plot results',...
                'Value',0,...
                'Callback',@(hObject,Event)O.plot,...
                'Position',[20 100 450 30]...
                );
            
        end % function
        
    end % methods
    
    methods (Static)
        
        function out = parenthesis(x, varargin) 
            
            out = x(varargin{:});
            
        end % function paren
        
    end % methods Static
end % classdef